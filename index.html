<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Media Manager</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <button id="themeToggle" title="Toggle Theme">☾</button>
  <button id="settingsBtn" title="Settings">
    ⚙
  </button>
  <nav class="tabs">
  <div id="settingsOverlay">
    <div id="settingsPanel">
      <div class="setting-row">
        <h3>Settings</h3>
        <button id="settingsCloseBtn">Close</button>
      </div>
      <div class="setting-row">
        <input type="checkbox" id="clipToggle">
        <label for="clipToggle">Enable clipping</label>
      </div>
      <div class="setting-row">
        <input type="checkbox" id="clipPreviewToggle">
        <label for="clipPreviewToggle">Clip preview</label>
      </div>
      <div class="setting-row">
        <input type="checkbox" id="selectiveDownloadToggle">
        <label for="selectiveDownloadToggle">Selective downloads</label>
      </div>
      <div class="setting-row">
        <label for="downloadConcurrencyRange">Download concurrency</label>
        <input type="range" id="downloadConcurrencyRange" min="1" max="8" step="1" value="2">
        <span id="downloadConcurrencyValue">2</span>
      </div>
      <div class="setting-row">
        <div class="storage-menu">
          <button id="storageMenuBtn" type="button">Storage</button>
          <div id="storageMenuPanel" class="storage-menu-panel" role="menu" aria-hidden="true">
            <button id="storageDeleteBtn" type="button" class="danger-button storage-menu-item">Delete storage</button>
            <button id="storageExportBtn" type="button" class="storage-menu-item">Export</button>
            <button id="storageImportBtn" type="button" class="storage-menu-item">Import</button>
          </div>
        </div>
      </div>
      <div class="setting-row" id="devMenuRow" style="display:none;">
        <button id="devMenuBtn" type="button">Dev Menu</button>
        <span class="dev-menu-status" id="devMenuStatus">Developer tools</span>
      </div>
    </div>
  </div>
    <button onclick="location.href='./index.html'" class="tab-button">Home</button>
    <div class="dropdown">
      <button class="tab-button dropbtn">Sources</button>
      <div class="dropdown-content">
        <button onclick="location.href='./Creator/index.html'" class="tab-button dropdown-item">Modify or Create</button>
        <button onclick="location.href='./Directorys/index.html'" class="tab-button dropdown-item">Public sources</button>
      </div>
    </div>
  </nav>
  <header>RSP Media Manager</header>
  <div id="homeMainRegion">
    <section id="recentSourcesRail" class="recent-sources" aria-label="Recent sources" hidden></section>
    <div class="container" id="playerContainer">
      <div id="urlInputContainer">
        <div id="errorMessage">Unfortunately, there was no directory given. Please try again or enter directory below.</div>
        <input type="text" id="urlInput" placeholder="https://example.com/list.json, Catbox ID, or Select Folder for local">
        <button id="goBtn">Go</button>
        <label for="folderInput" class="folder-button">Select Folder</label>
      <input type="file" id="folderInput" webkitdirectory multiple style="display:none">
    </div>
    <div id="directoryHeader" class="directory-header">
      <img id="directoryPoster" alt="Poster" referrerpolicy="no-referrer" />
      <h2 id="directoryTitle"></h2>
    </div>
    <div id="selectorScreen" style="display: none;">
      <div id="resumeMessage"></div>
      <h2>Select an Episode</h2>
      <div id="episodeList"></div>
      <button id="downloadBtn">⤓ Download Source</button>
    </div>
    <div id="playerScreen" style="display: none;">
      <div id="loadingSpinner" class="spinner"></div>
      <!-- CBZ progress overlay -->
      <div id="cbzProgressOverlay">
        <div id="cbzProgressContent">
          <div id="cbzProgressHeader">
            <p id="cbzProgressMessage">Preparing…</p>
            <div id="cbzInfoWrap" class="cbz-info-wrap" aria-describedby="cbzInfoTooltip">
              <button id="cbzInfoBtn" type="button" title="Why does this take time?" aria-label="Why does this take time?">i</button>
              <div id="cbzInfoTooltip" class="cbz-info-tooltip" role="tooltip">
                Due to the way we store pages (in cbz/zip files), we have to load the entire set at once. we apologize for the inconvenience.
              </div>
            </div>
          </div>
          <progress id="cbzProgressBar" max="100" value="0"></progress>
        </div>
      </div>
      <button id="backBtn">≡</button>
      <button id="theaterBtn" title="Pop-out Player">⤴</button>
      <button id="clipBtn">Clip</button>
      <h2 id="videoTitle">Loading...</h2>
      <div id="separatedPartsBar" class="separated-parts-bar" role="group" aria-label="Part selection"></div>
      <video id="videoPlayer" controls autoplay playsinline></video>
      <!-- CBZ Viewer -->
      <div id="cbzViewer" style="display:none">
        <div id="cbzControls" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75em;gap:0.5em;">
          <button id="cbzPrevBtn" title="Previous Page">⟵ Prev</button>
          <span id="cbzPageInfo" style="font-weight:600;">Page 1 / 1</span>
          <button id="cbzNextBtn" title="Next Page">Next ⟶</button>
        </div>
        <div id="cbzImageWrap" style="overflow:hidden;display:flex;justify-content:center;align-items:center;">
          <img id="cbzImage" alt="Comic Page" style="max-height:80vh;max-width:100%;object-fit:contain;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.5);" />
        </div>
      </div>
      <div id="placeholderNotice">
        To view this file, please download the respective category from the source and merge with the folders.
      </div>
      <button id="nextBtn">Next Item</button>
    </div>
  </div>
  </div>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
  <script defer src="scripts/constants.js"></script>
  <script defer src="scripts/alerts.js"></script>
  <script defer src="scripts/dev-core.js"></script>
  <script defer src="scripts/dom.js"></script>
  <script defer src="scripts/recent-sources.js"></script>
  <script defer src="scripts/player.js"></script>
  <script defer src="scripts/popout.js"></script>
  <script defer src="scripts/list.js"></script>
  <script defer src="scripts/downloads.js"></script>
  <script defer src="scripts/catbox.js"></script>
  <script defer src="scripts/clip.js"></script>
  <script defer src="scripts/settings.js"></script>
  <script defer src="scripts/dev-menu.js"></script>
  <script defer src="scripts/theme.js"></script>
  <script defer src="scripts/init.js"></script>
  <script defer src="scripts/local-folder.js"></script>
  <script defer src="scripts/storage.js"></script>
  <script defer src="scripts/version.js"></script>
  <!-- Clear Storage Confirm Overlay moved outside nav for full-screen coverage -->
  <div id="clearStorageOverlay">
    <div id="clearStoragePanel">
      <div class="setting-row">
        <h3>Confirm Clear Storage</h3>
      </div>
      <p>This will remove all saved progress, preferences, and cached data for this app. This cannot be undone.</p>
      <div class="setting-row">
        <button id="clearStorageConfirmBtn" class="danger-button">Yes, clear storage</button>
        <button id="clearStorageCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <div id="storageImportOverlay">
    <div id="storageImportPanel">
      <div class="setting-row">
        <h3>Import Settings</h3>
      </div>
      <p>Select a Catbox code or JSON file to load settings.</p>
      <label for="storageImportCodeInput" class="import-label">Catbox code or URL</label>
      <input id="storageImportCodeInput" type="text" placeholder="abc123 or https://files.catbox.moe/abc123.json">
      <div class="import-divider">or</div>
      <label for="storageImportFileInput" class="import-label">Import JSON file</label>
      <input id="storageImportFileInput" type="file" accept="application/json">
      <div id="storageImportActionsRow" class="setting-row import-actions">
        <button id="storageImportConfirmBtn" type="button">Import</button>
        <button id="storageImportCancelBtn" type="button">Cancel</button>
      </div>
    </div>
  </div>
  <div id="devMenuOverlay" aria-hidden="true">
    <div id="devMenuPanel" role="dialog" aria-modal="true" aria-labelledby="devMenuTitle" tabindex="-1">
      <div class="dev-menu-header">
        <h3 id="devMenuTitle">Developer Menu</h3>
        <button id="devMenuCloseBtn" type="button">Close</button>
      </div>
      <div class="dev-menu-content">
        <section class="dev-menu-section" aria-labelledby="devMenuModeHeading">
          <h4 id="devMenuModeHeading">Mode</h4>
          <label class="dev-menu-toggle" for="devModeToggle">
            <input type="checkbox" id="devModeToggle">
            <span>Enable developer mode</span>
          </label>
          <p class="dev-menu-hint">Toggle with O + P at any time.</p>
        </section>
        <section class="dev-menu-section" aria-labelledby="devMenuSettingsHeading">
          <h4 id="devMenuSettingsHeading">Dev Settings</h4>
          <div class="dev-field">
            <label for="devConcurrencyInput">Download concurrency</label>
            <div class="dev-field-controls">
              <input id="devConcurrencyInput" type="number" min="1" step="1" inputmode="numeric">
              <button id="devConcurrencyResetBtn" type="button">Reset</button>
            </div>
            <p class="dev-menu-hint">Applies instantly. Dev mode removes the usual UI limit.</p>
          </div>
        </section>
        <section class="dev-menu-section" aria-labelledby="devMenuExperimentalHeading">
          <h4 id="devMenuExperimentalHeading">Experimental settings</h4>
          <label class="dev-menu-toggle" for="devRecentSourcesToggle">
            <input type="checkbox" id="devRecentSourcesToggle">
            <span>Show recent sources on home</span>
          </label>
          <div class="dev-field" id="devRecentSourcesPlacementRow">
            <label for="devRecentSourcesPlacement">Placement</label>
            <select id="devRecentSourcesPlacement">
              <option value="top">Top</option>
              <option value="bottom">Bottom</option>
              <option value="left">Left</option>
              <option value="right">Right</option>
            </select>
          </div>
          <p class="dev-menu-hint">Displays the last 6 sources using SourceList cards.</p>
        </section>
        <section class="dev-menu-section" aria-labelledby="devMenuActionsHeading">
          <h4 id="devMenuActionsHeading">System Triggers</h4>
          <div class="dev-action-grid" id="devActionGrid">
            <button type="button" data-dev-action="notice:info">Show info notice</button>
            <button type="button" data-dev-action="notice:error">Show error notice</button>
            <button type="button" data-dev-action="storage:menu">Open storage menu</button>
            <button type="button" data-dev-action="storage:clear">Confirm clear storage</button>
            <button type="button" data-dev-action="storage:import">Open import overlay</button>
            <button type="button" data-dev-action="catbox:detect">Run Catbox detection</button>
            <button type="button" data-dev-action="clip:preset">Open clip presets</button>
            <button type="button" data-dev-action="clip:overlay">Show clip overlay</button>
            <button type="button" data-dev-action="player:popout">Trigger pop-out</button>
          </div>
        </section>
        <section class="dev-menu-section" aria-labelledby="devMenuDiagnosticsHeading">
          <div class="dev-menu-diagnostics-header">
            <h4 id="devMenuDiagnosticsHeading">Diagnostics</h4>
            <button id="devDiagnosticsRefreshBtn" type="button">Refresh</button>
          </div>
          <dl class="dev-stats">
            <div class="dev-stat">
              <dt>Dev mode</dt>
              <dd id="devModeStateLabel">Off</dd>
            </div>
            <div class="dev-stat">
              <dt>Download concurrency</dt>
              <dd id="devConcurrencyStateLabel">—</dd>
            </div>
            <div class="dev-stat">
              <dt>Active Catbox endpoint</dt>
              <dd id="devCatboxEndpointLabel">Pending</dd>
            </div>
            <div class="dev-stat">
              <dt>Source key</dt>
              <dd id="devSourceKeyLabel">Not loaded</dd>
            </div>
          </dl>
        </section>
      </div>
    </div>
  </div>
  <div id="clipOverlay">
    <div id="clipOverlayContent">
      <button id="clipOverlayCloseBtn" class="overlay-close" type="button" aria-label="Close clip dialog">✕</button>
      <div id="clipMessage"></div>
      <div id="clipButtonsRow">
        <button id="clipDoneBtn">Done</button>
        <button id="clipDownloadBtn">Download</button>
      </div>
    </div>
  </div>
  <div id="clipPresetOverlay">
    <div id="clipPresetContent">
      <h3>Select Clip Length</h3>
      <div id="clipPresetButtons"></div>
      <div class="clip-custom-row">
        <div class="trim-slider" id="trimSlider">
          <div class="trim-track"></div>
          <div class="trim-range" id="trimRange"></div>
          <button class="trim-handle" id="trimHandleStart" type="button" aria-label="Clip start"></button>
          <button class="trim-handle" id="trimHandleEnd" type="button" aria-label="Clip end"></button>
          <div class="trim-mark" id="trimPreviewMarker"></div>
        </div>
        <div class="clip-custom-controls">
          <div class="trim-display">
            <span>Start: <span id="clipDisplayStart">00:00</span></span>
            <span>End: <span id="clipDisplayEnd">00:20</span></span>
            <span>Length: <span id="clipDisplayLength">00:20</span></span>
          </div>
          <button id="clipCustomStartBtn" type="button">Start</button>
        </div>
        <small class="clip-custom-hint">Drag handles to choose the clip window.</small>
      </div>
      <label class="clip-remember-row">
        <input type="checkbox" id="clipRememberPreset">
        <span>Remember last selection</span>
      </label>
      <div id="clipHistorySection">
        <div class="clip-history-header">
          <h4>Recent Clips</h4>
          <button id="clipHistoryClearBtn" type="button">Clear</button>
        </div>
        <div id="clipHistoryList"></div>
      </div>
      <button id="clipPresetCloseBtn" type="button" class="overlay-close" aria-label="Close clip presets">✕</button>
    </div>
  </div>
  <!-- Clip progress overlay -->
  <div id="clipProgressOverlay">
    <div id="clipProgressContent">
      <p id="clipProgressMessage"></p>
      <progress id="clipProgressBar" max="100" value="0"></progress>
    </div>
  </div>
  <a href="https://github.com/RandomSideProjects" target="_blank" id="githubLink">
    <span>RandomSideProjects</span>
    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
  </a>
</body>
</html>
